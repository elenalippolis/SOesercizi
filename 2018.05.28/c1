fai controllare

/* La struttura di sincronizzazione riempisvuota ha le seguenti caratteristiche:
-) entrano MAX processi, e fino a che non è piena nessun processo può uscire
-) i processi devono uscire in ordine inverso rispetto all'ordine di arrivo.
Quando un processo vuole usare la struttura riempisvuota chiama la seguente funzione:
 def riempisvuotasynch():
 riempisvuota.entra(getpid())
 riempisvuola.esci(getpid())
Scrivere il monitor riempisvuota.
*/
//entrano max processi finché non è pieno nessuno esce
//i proc escnoo in ordine inverso rispetto all arrivo

#define MAX;
monitor riempisvuota{
stack <pid_t, condition> buffer;
condition ok2entra;
int count;
bool staRiempiendo;

	//entrano MAX processi, finché non è pieno nessuno esce
	entra(pid){
		count ++;
		if(count == MAX){
			staRiempiendo=false;
			ok2esci.signal();
			ok2entra.wait();
		} 
		staRiempiendo = true;
		condition c = new condition;
		buffer.push(pid, c);
		c.wait();
		count --;
	}
	
	esci(pid){
		if(staRiempiendo){
			ok2esci.wait();
		}
		while(!buffer.empty()){
			c, p = buffer.head();
			if(p==pid){
				buffer.remove(c, p);
				c.signal();
			} else {
				ok2esci.signal();
			}
		}
		staRiempiendo = true;
	}
}


